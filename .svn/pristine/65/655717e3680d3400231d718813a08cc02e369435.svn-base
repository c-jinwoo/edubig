<%
/****************************************************
	system	: 기업 등록
	summary	:	
	wdate	: 2018-06-21
	writer	: sangs
*****************************************************/
%>
<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>

<!----- 주소검색 레이어 START----->
<div id="layer" style="display:none;position:fixed;overflow:hidden;z-index:9999;-webkit-overflow-scrolling:touch;">
<img src="//t1.daumcdn.net/localimg/localimages/07/postcode/320/close.png" id="btnCloseLayer" style="cursor:pointer;position:absolute;right:-3px;top:-3px;z-index:1" onclick="closeDaumPostcode()" alt="닫기 버튼">
</div>

<script src="https://ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js?autoload=false"></script>
<script>
	function isMobile() {
	    return /Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
	}
	
    // 우편번호 찾기 화면을 넣을 element
    var element_layer = document.getElementById('layer');

    function closeDaumPostcode() {
        // iframe을 넣은 element를 안보이게 한다.
        element_layer.style.display = 'none';
    }

    function openDaumPostcode() {
    	
    	daum.postcode.load(function(){
	        new daum.Postcode({
	            oncomplete: function(data) {
	
	                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
	                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
	                var fullAddr = data.address; // 최종 주소 변수
	                var extraAddr = ''; // 조합형 주소 변수
	
	                // 기본 주소가 도로명 타입일때 조합한다.
	                if(data.addressType === 'R'){
	                    //법정동명이 있을 경우 추가한다.
	                    if(data.bname !== ''){
	                        extraAddr += data.bname;
	                    }
	                    // 건물명이 있을 경우 추가한다.
	                    if(data.buildingName !== ''){
	                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
	                    }
	                    // 조합형주소의 유무에 따라 양쪽에 괄호를 추가하여 최종 주소를 만든다.
	                    fullAddr += (extraAddr !== '' ? ' ('+ extraAddr +')' : '');
	                }
	                
	                // 우편번호와 주소 정보를 해당 필드에 넣는다.
	                document.getElementById('officePostNo').value = data.zonecode; //5자리 새우편번호 사용
	                document.getElementById('officeAddr1').value = fullAddr;
	                //document.getElementById('sample2_addressEnglish').value = data.addressEnglish;
	
	                // iframe을 넣은 element를 안보이게 한다.
	                // (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
	                element_layer.style.display = 'none';
	                
	                closeDaumPostcode();
	            },
	            width : '100%',
	            height : '100%',
	            maxSuggestItems : 5
	        }).embed(element_layer);
    	});
        // iframe을 넣은 element를 보이게 한다.
        element_layer.style.display = 'block';

        // iframe을 넣은 element의 위치를 화면의 가운데로 이동시킨다.
        initLayerPosition();
    }

    // 브라우저의 크기 변경에 따라 레이어를 가운데로 이동시키고자 하실때에는
    // resize이벤트나, orientationchange이벤트를 이용하여 값이 변경될때마다 아래 함수를 실행 시켜 주시거나,
    // 직접 element_layer의 top,left값을 수정해 주시면 됩니다.
    function initLayerPosition(){
    	
        var width = 300; //우편번호서비스가 들어갈 element의 width
    	if (!isMobile()) {
    		width = 620;
    	}
    	
        var height = 400; //우편번호서비스가 들어갈 element의 height
        var borderWidth = 2; //샘플에서 사용하는 border의 두께

        // 위에서 선언한 값들을 실제 element에 넣는다.
        element_layer.style.width = width + 'px';
        element_layer.style.height = height + 'px';
        element_layer.style.border = borderWidth + 'px solid';
        // 실행되는 순간의 화면 너비와 높이 값을 가져와서 중앙에 뜰 수 있도록 위치를 계산한다.
        element_layer.style.left = (((window.innerWidth || document.documentElement.clientWidth) - width)/2 - borderWidth - 6) + 'px';
        element_layer.style.top = (((window.innerHeight || document.documentElement.clientHeight) - height)/2 - borderWidth) + 'px';
    }
</script>
<!----- 주소검색 레이어 END----->
<script type="text/javascript">

	var officeFormBody = "";

	
	$(document).ready(function() {
		officeFormBody = $("#inserOfficeTable").html();
		
		$("#popOfficeFormClose").on("click", function() {
				
			$("#popOfficeForm").find('input').val('');
			$("compBiznoInput").text('');
			$("#inserOfficeTable").children().remove();
			$("#inserOfficeTable").html(officeFormBody);
		});
		
	})
	
	// 우편번호
	function fnZipSelect(zipNo,roadAddr) {
		
		
		var zipCode = Number(zipNo);
		
		zipCode += "";
		
		if(zipCode.length == 4){
			zipCode  = "0"+zipCode;
		}
		
		$("#officePostNo").val(zipCode);
		$("#officeAddr1").val(roadAddr);
		$("#srchText").val('');
		$(".table_style_row02").children().html('');
		$(".table_style_row02").html(zipBody);
		$("#popPost").find("#compPopClose").click();
		
	} 

	
	function goBack2() {
		$("#inserOfficeTable").children().remove();
		$("#inserOfficeTable").html(officeFormBody);
		$('#popOfficeFormClose').click();
	}
	
	
	
	function fnSave() {

	 var msg = "";
	 var pageMode = $("#pageMode").val();
	 if(pageMode == '' || pageMode == 'lecuture') {
		 msg = "등록";
	 } else {
		 msg = "수정";
	 }
	 
	 
 	 if(!fnValiCheck($("#officeName"), '기관명을 입력해주세요.'))return false;
	 if(!fnValiCheck($("#officePostNo"), '우편번호를 입력해주세요.'))return false;
	 if(!fnValiCheck($("#officeAddr1"), '주소를 입력해주세요.'))return false;
	 if(!fnValiCheck($("#officeAddr2"), '상세주소를 입력해주세요.'))return false;
	 if(!fnValiCheck($("#officeCeoNm"), '대표자명을 입력해주세요.'))return false;
	 
	 var compBizno = $("#compBizno1").val() + $("#compBizno2").val() + $("#compBizno3").val();
	 
	 $.ajax({
		type: 'POST',
	    dataType : "json",
		url: '/ccedu/visit/officeInsert.do',
		data : 
			{
				compBizno  : compBizno,
				compNm     : $("#officeName").val(),
				compPostNo : $("#officePostNo").val(),
				compAddr1  : $("#officeAddr1").val(),
				compAddr2  : $("#officeAddr2").val(),
				compCeoNm  : $("#officeCeoNm").val()
			},
	
			success:function(data){
				if(data.msg == "SUCCESS"){
					console.log(data);

					$("#compNm").val(data.compNm);
					$("#compNo").val(data.compNo);
					$("#compPostNo").val(data.compPostNo);
					$("#compAddr1").val(data.compAddr1);
					
					var data2 = "";
					
					if(isEmpty(data.compAddr2)){
						// true
					}else{
						// flase
						data2 = data.compAddr2
						$("#compAddr2").val(data2);
					}
									
					var htmlStr = ""; 
					htmlStr += ""+$("#compPostNo").val()+"</br>";
					htmlStr += $("#compAddr1").val();
					htmlStr += "&nbsp;&nbsp;";
					htmlStr += $("#compAddr2").val();
					
					$('#compAddr').html(htmlStr);
					
					$("#compBizno1, #compBizno2, #compBizno3, #officeName, #officePostNo, #officeAddr1, #officeAddr2, #officeCeoNm").val('');
					
					$("#compBizno1").val('');
					$("#compBizno2").val('');
					$("#compBizno3").val('');
					$("#inserOfficeTable").children().remove();
					$("#inserOfficeTable").html(officeFormBody)
					$("#popOfficeClose").click();
					$("#popOfficeFormClose").click();
					
					fnModalMsg('기관등록에 성공했습니다.');
					
				}else{
					$("#popOfficeClose").click();
					$("#popOfficeFormClose").click();
					fnModalMsg('기관등록에 실패했습니다.');
				}
			}
		});	// ajax
 	}
	
	function isEmpty(str){
        
        if(typeof str == "undefined" || str == null || str == "")
            return true;
        else
            return false ;
    }
	
</script>

<form method="post" name="compForm" id="compForm">
	<input type="hidden" name="qu" id="qu" value="<c:out value="${REQUEST_DATA.qu }"/>">
	<input type="hidden" name="pageMode" id="pageMode" value="${REQUEST_DATA.pageMode }"/>
	<input type="hidden" name="comno" id="comno" value="${REQUEST_DATA.comno }"/>
	<input type="hidden" name="registChk" id="registChk" value=""/>
	<input type="hidden" name="compBizno1" id="compBizno1" value=""/>
	<input type="hidden" name="compBizno2" id="compBizno2" value=""/>
	<input type="hidden" name="compBizno3" id="compBizno3" value=""/>


<!-- layer pop 기관등록 -->
<div class="layerpop company" id="popOfficeForm" tabindex="0" data-tooltip-con="popsearch04" data-focus="popsearch04" data-focus-prev="popsearch04-close">
	<div class="layer_mask tooltip"></div><!-- 블랙mask영역 -->
	<div class="layer_cont">
		<div class="lc_head">
			<h4 class="lc_tit">기관 등록</h4>
		</div>
		<div class="lc_cont">

			<div class="company_con_search">
				
				<div class="table_style_row">
					<table id="inserOfficeTable">
						<caption>기본정보 등록하는 표 입니다.</caption>
						<colgroup>
							<col class="col2_1" />
							<col />
						</colgroup>
						<tr>
							<th scope="row">사업자번호</th>
							<td>
								<span id="compBiznoInput"></span>
							</td>
						</tr>
						<tr>
							<th scope="row">기관명</th>
							<td>
								<div class="form_field">
									<input type="text" id="officeName" name="officeName" maxlength="200" value="" title="기관명 입력" class="mobile_wid100" />
								</div>
							</td>
						</tr>
						<tr>    
							<th scope="row">주소</th> 
							<td>		
								<div class="form_field">
									<input type="text" id="officePostNo" style="cursor: default;" name="officePostNo" value="" readonly="readonly" title="우편번호 입력" class="input_postal_code" />
									<button class="btn_graybg02 btn_postal_code" onclick="openDaumPostcode(); return false;">우편번호 찾기</button>
									<div class="address_box">
										<input type="text" id="officeAddr1" style="cursor: default;" name="officeAddr1" value="" readonly="readonly" title="주소 입력" class="input_address" />
										<input type="text" id="officeAddr2" name="officeAddr2" value="" maxlength="200" title="상세주소 입력" class="input_detail_address" />
									</div>
								</div>
							</td>
						</tr>
						<tr>
							<th scope="row">대표자명</th>
							<td>
								<div class="form_field">
									<input type="text" id="officeCeoNm" name="officeCeoNm" maxlength="25" value="" title="대표자명 입력" class="mobile_wid100" />
								</div>
							</td>
						</tr>
					</table>
				</div>

				<div class="c_btn_center">
					<button class="btn_blueline02" onclick="goBack2(); return false;" type="button">취소</button>
					<button class="btn_bluebg02" type="button" onclick="fnSave(); return false;">확인</button>
				</div>

			</div>

		</div>
	</div>
	<button class="btn_close tooltip-close" id="popOfficeFormClose" data-focus="popsearch04-close" data-focus-next="popsearch04">닫기</button>
</div>
<!--// layer pop -->
</form>


<%@ include file="/WEB-INF/jsp/common/comp_pop_post.jsp"%>
