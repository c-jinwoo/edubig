<%
/****************************************
    subject : 회원관리
    summary : 회원관리 : 회원 확인
    author  : SANGS
    date    : 2018-06-15
****************************************/
%>
<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ include file="/WEB-INF/jsp/ccedu/inc/taglib_inc.jsp"%>
<%@ include file="/WEB-INF/jsp/ccedu/inc/head_inc.jsp"%>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script type="text/javascript">

$(function(){
  
	var retcode = '${retcode}';
	var joinYn = '${joinYn}';
	
	if(retcode == 'B000'){
		
		fnConfirm("실명인증이 완료되었습니다.", function(result) {
			
			if(joinYn != '' && joinYn == 'Y'){
				
				var telno = '${result[12]}';
				if(telno.length == 11){
					opener.document.frm.moblphon2.value= telno.substr(3,4);
					opener.document.frm.moblphon3.value= telno.substr(7,4);
				}else{
					opener.document.frm.moblphon2.value= telno.substr(3,3);
					opener.document.frm.moblphon3.value= telno.substr(6,4);
				}
				
				opener.document.frm.confirmGubun.value = 'PHONE';
				var ssn2 = '${result[8]}';
				var sex  = '${result[9]}';
				opener.document.frm.ssnCd.value= ssn2.substring(0,1);
				if(ssn2 != null && ssn2.length > 1){
					if(sex == '1'){
						$('#sex').val('M');
						opener.document.frm.sex.value= 'M';
					}else{
						$('#sex').val('F');
						opener.document.frm.sex.value= 'F';
					}
				}
// 				opener.document.frm.brthdySub.value = ssn2.substr(2,7);
				opener.document.frm.brthdy.value = ssn2;
				
				
				opener.document.frm.userName.value = '${result[7]}';
				opener.document.frm.di.value = '${result[4]}';
				opener.fnCertType('PHONE');
				//opener.document.frm.submit();
				
			} else {
				
				var ssn2 = '${result[8]}';
				
				// 부모창에서 가져온 생년월일, 이름
				var compareBrth = opener.document.getElementById("brthdyCd").value;
				var compareName = opener.document.getElementById("mberNmChk").value;
				
				// KCB 에서 가져온 USERNAME
				var userName = '${result[7]}';
				
				/*
				 * 1. 생년월일 
				 * 2. 이름 비교 
				 */ 
				
				if(compareBrth == ssn2.substr(2, 7) && compareName == userName) {
					
					opener.document.frm.confirmGubun.value = 'PHONE';
					opener.document.frm.di.value = '${result[4]}';
					opener.document.getElementById('certYn').innerHTML ='인증';
					
				} else {
					
					fnModalMsg("가입된 생년월일과 본인인증 생년월일이 다릅니다.<br/>관리자에게 문의해주시기 바랍니다.",function(){
						self.close();	
					});
					return false;
				}
				
			} 
			
			
			self.close(); 
			return false;
		});
		return false;
		
	}else{
		
		fnConfirm("실명인증을 실패하였습니다.", function(result) {
			if(joinYn != '' && joinYn == 'Y'){
				opener.document.frm.action = '/ccedu/user/memberJoinStep02.do';
			}else{
				opener.document.frm.action = '/ccedu/common/oldmemCert.do';
			}
			
			opener.document.frm.submit();
			self.close();
			return false;
		});
		return false;
		
	}
	
});


	
	/*  인증코드 참조 ::: 
		
		opener.document.kcbResultForm.mem_id.value = 			"${memId}";
		opener.document.kcbResultForm.rqst_caus_cd.value = 		"${rqstCausCd}";
		opener.document.kcbResultForm.result_cd.value = 		"${retcode}";
		opener.document.kcbResultForm.result_msg.value = 		"${result[1]}>";
		opener.document.kcbResultForm.svc_tx_seqno.value = 		"${result[2]}";
		opener.document.kcbResultForm.cert_dt_tm.value = 		"${result[3]}";
		opener.document.kcbResultForm.di.value = 				"${result[4]}";
		opener.document.kcbResultForm.ci.value = 				"${result5}";
		opener.document.kcbResultForm.name.value = 				"${result[7]}>";
		opener.document.kcbResultForm.birthday.value = 			"${result[8]}";
		opener.document.kcbResultForm.sex.value = 				"${result[9]}";
		opener.document.kcbResultForm.nation.value = 			"${result[10]}";
		opener.document.kcbResultForm.tel_com_cd.value = 		"${result[11]}";
		opener.document.kcbResultForm.tel_no.value = 			"${result[12]}";
		opener.document.kcbResultForm.return_msg.value = 		"${result[16]}";
	*/
	
	
</script>
</head>
</html>
