<%
/****************************************
    subject : 온라인서점
    summary : 온라인서점 > 교재 상세
****************************************/
%>
<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ include file="/WEB-INF/jsp/ccedu/inc/taglib_inc.jsp"%>
<%@ include file="/WEB-INF/jsp/ccedu/inc/top_inc.jsp"%>
<% pageContext.setAttribute("newline", "\n"); %>
<!DOCTYPE html>
<html lang="ko">
<head>
<%@ include file="/WEB-INF/jsp/ccedu/inc/head_inc.jsp"%>
<script type="text/javascript">
$(document).ready(function(){
	$('.modal-backdrop').click(function(){
		$('.modal-backdrop').hide();
		$('#layer_01').attr('style','display:none;');
		$('#layer_02').attr('style','display:none;');
	})
});
$(document).ready(function(){
	var content = '${result.CONTENT}';
	$("#book_cont").html(content);

	$("#bookamount").val(1);
	$("#bookprice").val(1 * ${result.PRICE_REAL});
});
function changeQty(val){
	var num = Number($("#amount").val());
	var result = num + val;
	if(result <= 0){
		return;
	}

	var original_price = ${result.PRICE};
	var real_price = ${result.PRICE_REAL};
	var appendHTML = "";
	appendHTML += '<span style="text-decoration:line-through;">'+original_price*result+'원</span>';
	appendHTML += '<span style="color:#E2450E;font-weight:700;margin-left:5px;">'+real_price*result+'원  (배송비 무료)</span>';
	
	$("#amount").val(num + val);
	$("#book_price").html(appendHTML);

	$("#bookamount").val(result);
	$("#bookprice").val(result * real_price);
}
function fnList() {
	location.href = "/ccedu/book/main.do?mtSubCode="+'${param.mtSubCode}';
}
function fnLogin(){
	$('#returnUrl').val("/ccedu/online/onlineDetailForm.do");
	$('form[name=frm]').attr('action', '/ccedu/common/login.do').submit();
}
//결제
function ftn_approval(){
	$("#frm").submit();	
}
</script>
<style>
.book_info_img{
	float:left;	
	width: 30%;
	text-align:center;
}
.book_info_img img{
	width:80%;
	height:auto;
}
.book_info_table{
	float:left;	
	width: 70%;
}
#book_cont img{
	max-width:100%;
}
</style>
</head>
<body>
<div id="wrap">
	<!-- header -->
	<%@ include file="/WEB-INF/jsp/ccedu/inc/header_inc.jsp"%>
	<!--// header -->
	<!-- container -->
	<div id="container">
		<div class="con_center">
		
			<!-- 메뉴 title -->
			<div class="cont_title_wrapper">
				<div class="wrapper">
					<h3 class="cont_title">${title}</h3>
				</div>
			</div>
			<!-- content 본문 -->
			<div id="content">
				<div class="wrapper">				
					<!-- 본문내용 -->
					<div class="cont_body">
						<form name="frm" id="frm" method=POST action="/ccedu/book/onlinePayment.do">
							<input type="hidden" name="userid" value="<c:out value="${REQUEST_DATA.SES_USERID}"/>"/>
							<input type="hidden" name="userno" value="<c:out value="${REQUEST_DATA.SES_USERNO}"/>"/>
							<input type="hidden" name="usernm" value="<c:out value="${REQUEST_DATA.SES_USERNAME}"/>"/>
							<input type="hidden" name="bookno" value="<c:out value="${result.BOOKNO}"/>"/>
							<input type="hidden" name="booknm" value="<c:out value="${result.TITLE}"/>"/>
							<input type="hidden" name="bookprice" id="bookprice" value=""/>
							<input type="hidden" name="bookamount" id="bookamount" value=""/>
							<input type="hidden" name="mtSubCode" id="mtSubCode" value="${param.mtSubCode}"/>
									
						<div class="c_section" style="overflow:hidden;">
							<h4 class="c_tit">도서기본정보</h4>
							<div class="table_style_row book_info_img">
								<img style="max-width:100%;" src="/att_file/book/<c:out value="${result.SAVFILE}"/>" alt="<c:out value="${result.TITLE}"/>" />
							</div>
							<div class="table_style_row book_info_table">
								<table>
									<colgroup>
										<col class="col2_1" />
										<col />
										<col />
										<col />
									</colgroup>
									<tr>
										<th scope="row">도서명</th>
										<td colspan="3"><c:out value="${result.TITLE}"/></td>
									</tr>
									<tr>
										<th scope="row">저자</th>
										<td><c:out value="${result.B_WRITER}"/></td>
										<th scope="row">출판사</th>
										<td><c:out value="${result.B_COMP}"/></td>
									</tr>
									<tr>
										<th scope="row">페이지</th>
										<td><c:out value="${result.B_PAGE}"/></td>
										<th scope="row">발행일</th>
										<td><c:out value="${result.B_PUBD}"/></td>
									</tr>
									<tr>
										<th scope="row">ISBN</th>
										<td colspan="3"><c:out value="${result.B_ISBN}"/></td>
									</tr>
									<tr>
										<th scope="row">수량</th>
										<td colspan="3">
											<input type="text" id="amount" name="amount" value="1" style="border: 1px solid #EDEDED;width:100px;"/>
											<button type="button" class="button" onclick="changeQty(1);" style="width:30px;">＋</button>
											<button type="button" class="button" onclick="changeQty(-1);" style="width:30px;">-</button>
										</td>
									</tr>
									<tr>
										<th scope="row">가격</th>
										<td id="book_price" colspan="3">
											<span style="text-decoration:line-through;"><c:out value="${result.PRICE}"/>원</span>
											<span style="color:#E2450E;font-weight:700;margin-left:5px;"><c:out value="${result.PRICE_REAL}"/>원 (배송비 무료)</span>									
										</td>
									</tr>	
								</table>
							</div>
						</div>
						
						<div class="c_section" style="margin-top:100px;">
							<h4 class="c_tit">도서상세정보</h4>
							<div class="table_style_row">
								<table>
									<colgroup>
										<col class="col2_1" />
										<col />
									</colgroup>
									<tr>
										<th scope="row" style="text-align:center;">도서소개</th>
										<td id="book_cont"></td>
									</tr>
								</table>
							</div>
						</div>
						
						<div class="c_section" style="margin-top:100px;">
							<h4 class="c_tit">이 도서를 사용하는 강의 목록</h4>
							<div class="table_style_row">
								<table>
									<colgroup>
										<col width="50%" />
										<col width="30%" />
										<col width="20%" />
									</colgroup>
									<tr>
										<th scope="row" style="text-align:center;">과정명</th>
										<th scope="row" style="text-align:center;">기간</th>
										<th scope="row" style="text-align:center;">가격</th>
									</tr>
									<c:forEach var="result" items="${classList}" varStatus="status">
										<tr>
											<td>
												<c:out value="${result.SEQ_TITLE}"/>
											</td>
											<td style="text-align:center;">
												<c:if test="${result.OPENTYPE eq 'A'}">
													상시 (<c:out value="${result.EDUDAY_DEL}"/>일)
												</c:if>
												<c:if test="${result.OPENTYPE eq 'D'}">
													<c:out value="${result.STUDY_SDATE}"/> ~ <c:out value="${result.STUDY_EDATE}"/>
												</c:if>											
											</td>	
											<td style="text-align:center;">
												<c:if test="${result.PRICE_DEL < 1000}">
													무료
												</c:if>
												<c:if test="${result.PRICE_DEL >= 1000}">
													<c:out value="${result.PRICE_DEL}"/>원
												</c:if>
											</td>
										</tr>																
									</c:forEach>
								</table>
							</div>
						</div>
	
						<div class="c_btn_center">
							<!-- 회원 -->
						    <c:if test = "${REQUEST_DATA.SES_USERID ne '' }">
								<button type="button" class="btn_bluebg03" onclick="ftn_approval();return false;" >구매하기</button>
						    </c:if>					    
							<!-- 비회원 -->
							<c:if test = "${REQUEST_DATA.SES_USERID eq '' }">
								<button type="button" class="btn_bluebg03" data-tooltip="alertpop01">구매하기</button>
							</c:if>						
							<button type="button" class="btn_blueline03" onclick="fnList(); return false;" title="목록">목록</button>
						</div>
						
						<!-- layer pop -->
						<div class="layerpop alertpop01" tabindex="0" data-tooltip-con="alertpop01" data-focus="alertpop01" data-focus-prev="alertpop01-close">
							<div class="layer_mask tooltip-close"></div><!-- 블랙mask영역 -->
							<div class="layer_cont">
								<div class="lc_head"></div>
								<div class="lc_cont">
	
									<p class="alert_txt">교재를 구매하시려면 로그인이 필요합니다.<br />로그인 페이지로 이동하시겠습니까?</p>
	
									<div class="p_btn_center">
										<a href="#none" class="btn_graybg02 tooltip-close">취소</a>
										<a href="#none" onclick="fnLogin();return false;" class="btn_bluebg02">확인</a>
									</div>
	
								</div>
							</div>
							<button class="btn_close tooltip-close" data-focus="alertpop01-close" data-focus-next="alertpop01">닫기</button>
						</div>
						<!--// layer pop -->
	
						<!--// end -->
						</form>
					</div>
					<!--// 본문내용 -->
				</div>
			<!--  -->
			</div>
			<!--// content 본문 -->			
		</div>
	</div>
	<!--// container -->
	<!-- foot -->
	<%@ include file="/WEB-INF/jsp/ccedu/inc/footer_inc.jsp"%>
	<!--// foot end -->
</div>
</body>
</html>