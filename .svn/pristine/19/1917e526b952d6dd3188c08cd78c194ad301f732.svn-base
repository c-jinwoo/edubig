<%
/****************************************
    subject : 온라인교육
    summary : 온라인교육 > 교육소개
    author  : SANGS
    date    : 2018-06-15
****************************************/
%>
<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ include file="/WEB-INF/jsp/ccedu/inc/taglib_inc.jsp"%>
<!DOCTYPE html>
<html lang="ko">
<head>
	<title>금융계산기 > 지식마당 > 신용회복위원회 </title>
	<%@ include file="/WEB-INF/jsp/ccedu/inc/head_inc.jsp"%>
<script type="text/javascript">


	$(document).ready(function(e){
		$('.resultData').hide();
	});


	function moveTab(){
		$('#tab').val("");
		$('form[name=frm]').attr('action', '/ccedu/intellectual/financialCalculator.do').submit();
	}
	
	function goResult(p_action){

		if(!fnValiCheck($('#p_omoney'),"대출금액 입력해주세요.")) return false;
		if(!fnValiCheck($('#p_interest'),"대출금리 입력해주세요.")) return false;
		if(!fnValiCheck($('#p_omonth'),"대출기간 개월수 입력해주세요."))return false; 


		if(!isNumber($('#p_omoney').val().replace(/,/gi, ""))){
			fnModalMsg("숫자만 입력 가능 합니다.",function(){
				$('#p_money').val("");
				$('#p_money').focus();
			});
			return false;
		}

		if(!isNumber($('#p_interest').val().replace(/,/gi, ""))){
			fnModalMsg("숫자만 입력 가능 합니다.",function(){
				$('#p_month').val("");
				$('#p_month').focus();
			});
			return false;
		}

		if(!isNumber($('#p_omonth').val().replace(/,/gi, ""))){
			fnModalMsg("숫자만 입력 가능 합니다.",function(){
				$('#p_rate').val("");
				$('#p_rate').focus();
			});
			return false;
		}

		if(parseInt($('#p_omoney').val().replace(/,/gi, "")) > 2147483647 ){
			fnModalMsg('2,147,483,647원 이상 입력 하실 수 없습니다.',function(){
	    		$('#p_omoney').val("");
	    		$('#p_omoney').focus();	
	    	});
	    	return false;
		}

		if($('#p_omonth').val() > 450){
			$('#p_omonth').blur();
	    	fnModalMsg('450개월을 넘길 수 없습니다.',function(){
	    		$('#p_omonth').val("");
	    		$('#p_omonth').focus();	
	    	});
	       return false;
		}

		if($('#p_interest').val() == 0){
			fnModalMsg('대출금리를 정확히 입력해주세요.',function(){
	    		$('#p_interest').val("");
	    		$('#p_interest').focus();

	    	});	
	    	return false;
		}

		var append = "";
		var v_money			= parseInt($('#p_omoney').val().replace(/,/gi, ""));
		var v_month			= $('#p_omonth').val();
		
		var	v_interest	= 0.0;
		v_interest 			= $('#p_interest').val();
	
		var v_gubun 		= ""; // 상환방식


		$('input[name=p_principal]').each(function(){

			if($(this).is(':checked')){
				v_gubun = $(this).val();
			}

		});

		var v_retryMoney  			= 0.0;
		var v_returnMoney		  	= 0.0;
		var v_interestMoney		  	= 0.0;
		var v_rate					= 0.0;
		var total					= 0.0;
		var total_interest			= 0.0;		
		var total_returnMoney		= 0.0;
		
		var v_oldretryMoney  			= 0;
		var v_balance					= 0;
		
		
		for(var i=0; i < v_month; i++){		
			
			if(v_gubun == "B"){ //원리금 균등
				v_rate 			= 1+((v_interest*0.01)/12);
				v_retryMoney 	= (v_money*(1-v_rate)/(1-Math.pow(v_rate,v_month))); //납입 원금

				v_interestMoney = (v_money-(v_oldretryMoney))*(v_interest*0.01)/12; //매월이자
				
				v_returnMoney	= v_retryMoney + v_money*(v_interest*0.01)/12; //상환금액
				
				v_interestMoney	= Math.round(v_interestMoney);
				v_returnMoney   = Math.round(v_returnMoney);

				v_retryMoney    = (v_returnMoney - v_interestMoney); //재계산 납입 원금
				v_oldretryMoney	+= v_retryMoney;
				v_balance		= (v_money-v_oldretryMoney);
						
			}else{
				
				v_retryMoney	= v_money/v_month; //납입 원금

				v_retryMoney	= Math.round(v_retryMoney);
				v_interestMoney	= Math.round(((v_money-(v_retryMoney*i))*(v_interest*0.01)/12)); //매월이자
				v_returnMoney 	= Math.round((v_money/v_month) + v_interestMoney); //상환금액

				v_balance		= (v_money-(v_retryMoney*(i+1)));
				
			}	
	
			if((i+1)==v_month){ //마지막 개월 잔금은  0원으로..
				v_balance	= 0;
			}
			
			total_interest 		+= v_interestMoney;  //대출이자
			total_returnMoney	= v_money+total_interest; //총상환금
			

			append += '<tr>'
			append += '<td class="align_center">'
			append += i+1 //회차
			append += '</td>'
			append += '<td class="align_right">'
			append += change_price_result(v_returnMoney) + ' 원' //상환금액
			append += '</td>'
			append += '<td class="align_right">'
			append += change_price_result(v_retryMoney) + ' 원' //납입원금
			append += '</td>'
			append += '<td class="align_right">'
			append += change_price_result(v_interestMoney) + ' 원' //납입이자
			append += '</td>'
			append += '<td class="align_right">'
			append += change_price_result(v_balance) + ' 원' //잔금
			append += '</td>'
			append += '</tr>'

		}

		$('.resultData').show();
		$('.loan_table').find('tr').remove();
		$('.loan_table').html(append);
		$('.v_month_result').html(v_month);
		$('.v_omoney_result').html($('#p_omoney').val());
		$('.total_interest_result').html(change_price_result(total_interest));
		$('.total_returnMoney_result').html(change_price_result(total_returnMoney));

	}

	function isNumber(s) {
	  s += ''; // 문자열로 변환
	  s = s.replace(/^\s*|\s*$/g, ''); // 좌우 공백 제거
	  if (s == '' || isNaN(s)) return false;
	  return true;
	}

	function checkNum(pthis){

		if($(pthis).val() > 100){
			$(pthis).blur();
	    	fnModalMsg('연이율 100% 를 초과할 수 없습니다.',function(){
	    		$(pthis).val("");
	    		$(pthis).focus();	
	    	});
	       
	       return false;
		}

	    var _pattern2 = /^-?(\d{1,3}([.]\d{0,2})?)?$/;
	    if (!_pattern2.test($(pthis).val())) {       
	        $(pthis).blur();
	    	fnModalMsg('숫자와 소수점 둘째자리까지 입력할 수 있습니다.',function(){
	    		$(pthis).val("");
	    		$(pthis).focus();	
	    	});
	       
	       return false;
	    } 
	}

	//입력창에서 자동으로 숫자표기(,) 로 변환
	function change_price(loc) {
		var str3 =loc.value;  

		if(parseInt(str3.replace(/,/gi, "")) > 2147483647 ){
			$(loc).blur();
			fnModalMsg('2,147,483,647원 이상 입력 하실 수 없습니다.',function(){
	    		$(loc).val("");
	    		$(loc).focus();	
	    	});
		}


		 var result="";
		 for(i=0 ; i<str3.length ; i++)
		  if(str3.substring(i,i+1) == ","); 
		  else
		   result=result+str3.substring(i,i+1);
		   $("#p_omoney").val(magic(result));
	}

	function magic(str) {  
		  var result="";  
		  var len=str.length;  
		  for(i=len-1,j=0;i>=0;i--) {  
		    result=str.substring(i,i+1)+result;  
		    j++;  
		    if(j==3 && i!=0){  
		      result=","+result;  
		      j=0;  
		    }  
		  }  
		  return result;  
	}


	function change_price_result(priceData) {
		var str3 =String(priceData);
		 var result="";
		 for(i=0 ; i<str3.length ; i++)
		  if(str3.substring(i,i+1) == ","); 
		  else
		   result=result+str3.substring(i,i+1);
		   
		   return magic(result);
	}


</script>
</head>

<body>
<!-- skip nav -->
	<%@ include file="/WEB-INF/jsp/ccedu/inc/nav_inc.jsp"%>
<!--// skip nav -->


<div id="wrap">

	<!-- header -->
	<%@ include file="/WEB-INF/jsp/ccedu/inc/header_inc.jsp"%>
	<!--// header -->

	<!-- container -->
	<div id="container">

		<!-- location -->
		<jsp:include page="/WEB-INF/jsp/ccedu/inc/location/loc_04_03.jsp"> 
		  	<jsp:param name="menuNm" value="금융계산기"/> 
		</jsp:include> 
		<!--// location -->

		<div class="con_center">

			<!-- lnb -->
			<div id="lnb">
				<jsp:include page="/WEB-INF/jsp/ccedu/inc/lnb/lnb_04.jsp"> 
				  	<jsp:param name="dep2" value="03"/>
				</jsp:include>
			</div>
			<!--// lnb -->

						<!-- content 본문 -->
			<div id="content">
			
				<!-- 기존 START 2018-08-30  -->
<!-- 				<h3 class="cont_titile">금융계산기</h3> -->
				<!-- 기존 END 2018-08-30  -->
				
				<!-- 2018-08-28 김동인 작업 S --> 
				<h3 class="cont_titile type04">금융계산기<span></span></h3>
				<!-- 2018-08-28 김동인 작업 E -->

				<!-- 본문내용 -->
				<div class="cont_body">
					<!-- start -->
					<form name="frm" id="frm" action="" method="post">
						<input type="hidden" name="tab" id="tab" value="<c:out value="${REQUEST_DATA.tab}"/>"/>
					</form>
					<div class="c_section">

						<div class="c_tab_link">
							<ul>
								<li><a href="#none" onclick="moveTab();" title="예/적금">예/적금</a></li>
								<li><a href="#none" class="on" title="현재페이지">대출</a></li>
							</ul>
						</div>

						<ul class="c_txtlist">
							<li>원금균등분할상환 방식은 원금은 매월 일정한 금액(대출원금/대출기간)으로 나누어서 상환하고 만약 상환하지 못한 원금의 잔액이 있을 경우에는 최종회차 할부원금에 가산하고 이자는 대출잔액에 대하여 매월후이자로 납부하는 방식으로 상환금액(원금+이자)이 점점 줄어들게 됩니다.</li>
							<li>원리금균등분할상환 방식은 상환 원금과 이자를 합하여 만기일까지 매월 같은 금액으로 상환하고 만약 상환하지 못한 원금의 잔액이 있을 경우 최종회차 할부금에서 정산하는 방식으로 대출초기에 상환부담을 줄일 수 있습니다.</li>
						</ul>

						<div class="graybox_write loan">
							<dl>
								<dt>상환방식</dt>
								<dd>
									<input type="radio" id="p_principal" name="p_principal" value="A" checked="checked" />
									<label for="p_principal">원금균등분할상환</label>

									<input type="radio" id="p_principal2" name="p_principal" value="B" />
									<label for="p_principal2">원리금균등분할상환</label>
								</dd>
							</dl>
							<dl>
								<dt>대출금액</dt>
								<dd><input type="text" id="p_omoney" name="p_omoney" title="대출금액 입력" class="text" onkeyup="change_price(this);" />원</dd>
							</dl>
							<dl>
								<dt>대출금리</dt>
								<dd><input type="text" id="p_interest" name="p_interest" title="대출금리 입력" class="text" onkeyup="checkNum(this);" />% (연이율)</dd>
							</dl>
							<dl>
								<dt>대출기간</dt>
								<dd><input type="text" id="p_omonth" name="p_omonth" title="대출기간 개월수 입력" class="text" />개월</dd>
							</dl>
						</div>

					</div>

					<div class="c_btn_center">
						<button type="button" class="btn_bluebg03" onclick="goResult();">결과 보기</button>
					</div>

					<!-- 결과 -->
					<div class="c_section resultData">

						<h4 class="c_tit">결과 요약</h4>
						<p class="result_noti">* 매월이자는 월단위로 계산한 것이며, 실제 대출이자는 일단위로 계산하므로 차이가 있을 수 있습니다.</p>

						<div class="table_style_col mgt0">
							<table>
								<caption>대출기간, 대출원금, 대출이자, 총상환금액 을 확인할수있는 표 입니다.</caption>
								<colgroup>
									<col  />
									<col  />
									<col  />
									<col  />
								</colgroup>
								<thead>
									<tr>
										<th scope="col">대출기간</th>
										<th scope="col">대출원금</th>
										<th scope="col">대출이자</th>
										<th scope="col">총상환금액</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td class="align_center"><span class="v_month_result"></span> 개월</td>
										<td class="align_right"><span class="v_omoney_result"></span> 원</td>
										<td class="align_right"><span class="total_interest_result"></span> 원</td>
										<td class="align_right"><span class="total_returnMoney_result"></span> 원</td>
									</tr>
								</tbody>
							</table>
						</div>

						<div class="table_style_col">
							<table>
								<caption>회차, 상환금액, 납입원금, 납입이자, 잔금 을 확인할수있는 표 입니다.</caption>
								<colgroup>
									<col  />
									<col  />
									<col  />
									<col  />
									<col  />
								</colgroup>
								<thead>
									<tr>
										<th scope="col">회차</th>
										<th scope="col">상환금액</th>
										<th scope="col">납입원금</th>
										<th scope="col">납입이자</th>
										<th scope="col">잔금</th>
									</tr>
								</thead>
								<tbody class = "loan_table">
								</tbody>
							</table>
						</div>

					</div>
					<!--// 결과 -->

					<!--// end -->
				</div>
				<!--// 본문내용 -->
				
			<!--  -->
			</div>
			<!--// content 본문 -->


		</div>
	</div>
	<!--// container -->

	<!-- foot -->
	<%@ include file="/WEB-INF/jsp/ccedu/inc/footer_inc.jsp"%>
	<!--// foot end -->

</div>

</body>
</html>