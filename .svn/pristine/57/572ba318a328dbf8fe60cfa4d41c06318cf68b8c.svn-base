function setQuiz(_xml)
{
    var default_val = {
        xml: _xml
        , type: ""
        , page: ""
    }

    this.info = $.extend(null, default_val);
    this._try = 0;
    this._chance = 0;
    this._curPage = 1;
    this._totalPage = 0;
    this._correct = 0;
    this._answer = new Array();
    this._userAnswer = new Array();
    this._quizIndex = 50;
    initQuiz();

}

function initQuiz()
{
//  this.$quiz = $('<div class="quiz"><div class="leftSymbol"></div><div class="rightSymbol"></div><div class="wrongAnswer"></div><div class="noneCheck"></div></div>');
  this.$quiz = $('<div class="quiz"><div class="wrongAnswer"></div><div class="noneCheck"></div></div>');

  var _this = this;
  var xml = this.info.xml;  

  $(xml).find("quiz").each(function() {
    if($(this).attr("flag") == _this.$curPageNumber)
    {
      var totalPage = $(this).find("page").length;
      $(this).find("page").each(function(){
        var pageNum = $(this).attr("num");
        var pageType = $(this).attr("type");
        _this._answer[pageNum] = $(this).attr("answer");
        var quest = $(
         '<div class="page flag_' + pageNum + '">\
           <div class="question">\
           <div class=symbol>' + $(this).find('question > symbol').text() + '\
           <div class=oSymbol></div>\
           <div class=xSymbol></div>\
           </div>\
           <div class=text>' + $(this).find('question > text').text() + '</div>\
           </div>\
           <div class="example"></div>\
           <button class="confirm"></button>\
           <div class="feedback"></div>\
         </div>'
        );
        
        
        //4차시 1번퀴즈문제 css수정
        if(strChapter == 4 && pageNum == 1){
        	 quest.find(".feedback").css('top','78%');
        	 quest.find(".confirm").css('top','476px');
        }
        
        
        // quest.find(".question").attr("title", $(this).find("question > alternate").text());
//        setTitle(quest.find(".question"),$(this).find("question > alternate").text(),_this._quizIndex++);  //alternate삭제
        // quest.find(".feedback").attr("title", $(this).find("feedback > alternate").text());

        $(this).find("example").each(function(){
          
          quest.find(".confirm").hide(); //정답확인버튼 숨기기
          
          var examNum = $(this).attr("num");
          var exam = $('');
          if(pageType=="half") //보기가 2개인 경우
          {
            exam = $('<button class="'+pageType +' '+ pageType + '_' + examNum + '">\
                            <div class="symbol">v</div><span class="text">' + $(this).find("text").text() + '</span></button>');
            _this._chance = 1;
          }
          else if(pageType=="multiple") // 보기가 여러개일 경우
          {
            exam = $('<li class="'+pageType +' '+ pageType + '_' + examNum + '"><div class="btn'+$(this).attr("num")+'"></div>\
                            <span class="text">' + $(this).find("text").text() + '</span></li>');
            _this._chance = 2;
          }
          quest.find(".example").append(exam);
//          setTitle(exam,$(this).find("alternate").text(),_this._quizIndex++);  //alternate삭제
          exam.on('click keydown', function(e) {
            if(e.type=="keydown" && e.key!="Enter") return;
            _this._userAnswer[pageNum] = examNum;
            $(this).find("div").addClass("toggle");
            quest.find(".confirm").show();
            
            $(this).closest(".example").find('div').not($(this).find("div")).removeClass("toggle");
            $(this).closest(".example").find('.'+pageType).not($(this)).css("color","#333333");
            //$(this).css("color","#015896");
			$(this).css("color","#7601a7");
          });
          exam.on('mouseover', function() {
            //$(this).css("color","#015896");
			$(this).css("color","#7601a7");
//          $(this).addClass('btn'+examNum+"_hover");
          });
          exam.on('mouseleave', function() {
              $(this).css("color","#333333");

          });
        });
        quest.find(".feedback").append($('<div class="answer">\
                                            <span class="text">' + $(this).find("feedback > answer > text").text() + '</span></div>\
                                          <div class="explain"><span class=text>' + $(this).find("feedback > explain > text").text() + '</span></div>'));
        quest.find(".feedback").css("display","none");
        if(pageNum == totalPage) quest.find(".feedback").append($('<button class="resultBtn"></button>'));
        else quest.find(".feedback").append($('<button class="nextBtn"></button>'));

//        setTitle(quest.find(".feedback"),$(this).find("feedback > alternate").text(),_this._quizIndex++);   //alternate삭제


        _this.$quiz.append(quest);

        //확인하기 버튼 처리
        setButton(quest.find(".confirm"),'',_this._quizIndex++, function() {
          if(_this._userAnswer[pageNum]=="" || _this._userAnswer[pageNum]==undefined) //체크 안했을떄
          {
            _this.$quiz.find(".noneCheck").fadeIn(500).delay(1000).fadeOut(500);
            return;
          }
          _this._try++;
          if(_this._userAnswer[pageNum]==_this._answer[pageNum]) // 정답일떄
          {
        	 setAudio('right');
            _this._correct++;
            quest.find(".confirm").hide();
			if(strChapter == "04") { $(".feedback").css("top","65%"); }
            quest.find(".feedback").show();
            _this.$quiz.find(".flag_"+ pageNum +" > .question > .symbol > .oSymbol").css("display","block");
            _this.$quiz.find(".flag_"+ pageNum +" > .example > .multiple").off();
           // _this.$quiz.find(".flag_"+ pageNum +" > .example > .multiple_"+_this._answer[pageNum]).css("color","#015896");
            _this.$quiz.find(".flag_"+ pageNum +" > .example > .multiple_"+_this._answer[pageNum]).css("color","#7601a7");
          }
          else if(_this._try < _this._chance)
          {
        	 setAudio('wrong');
        	 quest.find(".confirm").hide();
            _this.$quiz.find(".wrongAnswer").fadeIn(500).delay(1000).fadeOut(500); //오답이지만 기회 남았을떄
            _this._userAnswer[pageNum]="";
            _this.$quiz.find(".flag_"+ pageNum +" > .example > .multiple  > .toggle").removeClass("toggle");
          }
          else //최종 오답
          {
        	 setAudio('wrong');
        	 quest.find(".confirm").hide();
			 if(strChapter == "04") { $(".feedback").css("top","65%"); }
             quest.find(".feedback").show();
            _this.$quiz.find(".flag_"+ pageNum +" > .question > .symbol > .xSymbol").css("display","block");
            _this.$quiz.find(".flag_"+ pageNum +" > .example > .multiple  > .btn"+_this._answer[pageNum]).addClass("correct");
           // _this.$quiz.find(".flag_"+ pageNum +" > .example > .multiple_"+_this._answer[pageNum]).css("color","#015896");
            _this.$quiz.find(".flag_"+ pageNum +" > .example > .multiple_"+_this._answer[pageNum]).css("color","#7601a7");
            _this.$quiz.find(".flag_"+ pageNum +" > .example > .multiple").off();
          }
        });
        
        
        
        //다음 문제 버튼
        setButton(quest.find(".feedback > .nextBtn"),'',_this._quizIndex++, function() {
          var nextPageNum = pageNum * 1 + 1;
          _this.$quiz.find(".flag_"+pageNum).hide(10);
          _this.$quiz.find(".flag_"+nextPageNum).show(10);
          _this._try = 0;
		  $(".text").css("bottom","44px");
		  $(".example").css("top","30%");
        });
        //결과 보기 버튼
        setButton(quest.find(".feedback > .resultBtn"),'',_this._quizIndex++, function() {
          _this.$quiz.find(".flag_"+pageNum).hide(10);
          showBoard(totalPage);
        });
        if(pageNum != 1) quest.css("display","none");
      });
    }
  });
  _this.$content.append(this.$quiz);
}


function showBoard(_totPage)
{
  _this = this;
  var resultBoard=$('<div class="board"><div class="top"><div class="symbol"></div><div class="explain_1"></div><div class="explain_2"></div></div>\
                    <div class="middle"></div><button class="retryBtn"></button></div>');
  
//  resultBoard.find('.top > .explain_1').text("총 " + _totPage +"문제 중 " +_this._correct+" 문제를 맞히셨습니다.");
//  setTitle(resultBoard.find('.top > .explain'),"총 " + _totPage +"문제 중 " +_this._correct+" 문제를 맞히셨습니다.",_this._quizIndex++);
  
  
  resultBoard.find('.top > .explain_1').text("총 " + _totPage +"문항 중 ");
  resultBoard.find('.top > .explain_2').text(+_this._correct+" 개를 맞히셨습니다.");
  setTitle(resultBoard.find('.top > .explain'),"총 " + _totPage +"문항 중 " +_this._correct+" 개를 맞히셨습니다.",_this._quizIndex++);
  
  for(var i=1; i<=_totPage; i++)
  {
    var temp = $('<div class="result result_'+ i +'"><div class="symbol"></div><div class="checkSymbol"></div></div>');
    if(_this._userAnswer[i]==_this._answer[i]) temp.find('.checkSymbol').addClass("oSymbol");
    else temp.find('.checkSymbol').addClass("xSymbol");

//    if(i!=1) resultBoard.find('.middle').append($('<div class="line"></div>'));
    resultBoard.find('.middle').append(temp);
  }
  setButton(resultBoard.find('.retryBtn'),'',_this._quizIndex++, function() {
    againQuiz();
  });
  _this.$quiz.append(resultBoard);

  _this.$nextAlert.fadeIn(1500);
  _this.$nextAlert.css("right","5px");
  setAudio('moveAlert'); //효과음
}


function againQuiz(){
  this._try = 0;
  this._chance = 0;
  this._curPage = 1;
  this._totalPage = 0;
  this._correct = 0;
  this.$quiz.remove();
  initQuiz();
  this.$quiz.fadeIn(1);
}