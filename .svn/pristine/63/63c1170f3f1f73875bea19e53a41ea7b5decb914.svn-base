<%
/****************************************************
	system	: 신용상담사 > 고객센터 > Q&A
	title	: 게시판 목록
	summary	:	
	wdate	: 2018-06-19
	writer	: SANGS
*****************************************************/
%>
<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ include file="/WEB-INF/jsp/ccedu/inc/taglib_inc.jsp"%>
<!DOCTYPE html>
<html lang="ko">
<head>
	<title>Q&A > 고객센터 > 신용상담사</title>
	<%@ include file="/WEB-INF/jsp/ccedu/inc/head_inc.jsp"%>

	<style type="text/css">
		.board_write table td .btn_u_photo_del {display:inline-block; margin:3px 5px; padding:0; border:none; background:none; vertical-align:bottom;}
		.board_write table td .btn_u_photo_del img {width:20px;}

	</style>

	<script type="text/javascript">

		$(document).ready(function(){
			var secuyn = '${rowData.SECUYN}' 

			if(secuyn == 'Y'){
				$('#secuAt').attr('checked',true)
			}
			
			var contentData = $('#content2').text();
			
			contentData = contentData.split('<br/>').join('\r\n');
			contentData = contentData.split('<br>').join('\r\n');
			
			$('#content2').text(contentData);
			
		});

		//첨부파일 개수
		var length = '${fn:length(listData)}';

		

		//리스트
		function fnList() {
			if("13" == $("#bcateno").val()) {
				$('#frm').attr('target', '_self').attr('action', '/ccedu/cc/cmtBoardList.do?bcateno=13').submit();
			} else if("10" == $("#bcateno").val()) {
				$('#frm').attr('target', '_self').attr('action', '/ccedu/intellectual/cmtBoardList.do?bcateno=10').submit();
			}
		}


		//파일 삭제
		function deleteBbsQnaFile(fileNo, pthis){
			
			fnConfirm("기존파일을 삭제하시겠습니까?" ,function(result) {
				if(result) {
					$.ajax({
			            url : "/ccedu/qna/bbsFileDeleteAjax.do",
			            data : { bbsNo : $('#bbsNo').val()
			            	   , fileNo : fileNo
			            },
			            dataType : "json",
			            type : 'post',
			            success : function(res) { 
		            		length--;
		            		fnModalMsg("삭제되었습니다.");
			            	$(pthis).parent().remove();
			            	return false;
			            },
			            error : function(e) {
			                alert("error :" + e.responseText);
			            }
			        });  
			         return false;
			         
				} else {
					return false;
				}
			});
		}


		//저장 및 수정
		function fnSave() {

			var msg = "등록";
			if($('#execFlag').val() == "UPDATE"){
				var aryData = new Array;
				$('input[name=delBbsNo]').each(function(){
					if($(this).is(':checked')){
						aryData.push($(this).val());
					}
					
				});
				msg = "수정";
				$('#fileNo').val(aryData);	
			}

			

			if($('#title').val() == ""){
				fnModalMsg("제목을 입력하세요.",function(){
					$('#title').focus();
				})

				return false;
			}
			

			if($('#content2').val() == ""){
				fnModalMsg("내용을 입력하세요.",function(){
					$('#content2').focus();
				})

				return false;
			}
			
			fnConfirm( msg + "하시겠습니까?", function(result){
				if(result){
					
					var data = $("#content2").val();
					var content = data.replace(/\n/gi,"<br/>").replace(/\r\n/gi,"<br/>").replace(/\r/gi,"<br/>");
					
					$("#content2").val(content);
					
					if($('#secuAt').is(":checked")){
						$('#secuYn').val('Y');
					}
					if("13" == $("#bcateno").val()) {
						$('#frm').attr('target', '_self').attr('action', '/ccedu/cc/bbsExec.do').submit();
					} else if("10" == $("#bcateno").val()) {
						$('#frm').attr('target', '_self').attr('action', '/ccedu/intellectual/bbsExec.do').submit();
					}
				}
			});
		}

		//add,del FILE
		var liFileID = 1; //개별ID
		function addFile(ts) {
			//최대 5개 추가
			if($(".bw_file li").length < 5-length)
			{
				liFileID++;
				var fileLi = "";
				fileLi += '<li>';
				fileLi += '<button type="button" class="btn_graybg02" onclick="$(\'#fileF_' + liFileID + '\').click();">파일찾기</button>';
				fileLi += '<input type="file" id="fileF_' + liFileID + '" name="fileNm_' + liFileID + '" title="파일을 선택하세요." tabindex="-1" class="alt_text" onchange="$(\'#fileNM_' + liFileID + '\').val($(this).val());" />';
				fileLi += '<input type="text" id="fileNM_' + liFileID + '" aria-hidden="true" tabindex="-1" class="text" title="'+liFileID+'. 선택된 파일명입니다." readonly="readonly" />';
				fileLi += '<div class="ctl">';
				fileLi += '	<button type="button" class="file_add" onclick="addFile(this);"><span class="alt_text">첨부파일</span>추가</button>';
				fileLi += '	<button type="button" class="file_del" onclick="delFile(this);"><span class="alt_text">첨부파일</span>삭제</button>';
				fileLi += '</div>'
				fileLi += '</li>';

				$(ts).parents("li").after(fileLi);
			}
			else
			{
				fnModalMsg("최대 5개까지 첨부할수 있습니다.")
			}
			
		}

		function delFile(ts) {
			//최소 1개 보유
			if($(".bw_file li").length > 1)
			{
				$(ts).parents("li").remove();
			}
			else
			{
				fnModalMsg("삭제불가");
			}
			
		}
		
		function fnDel() {
			fnConfirm("정말로 삭제하시겠습니까?", function(result) {
				
				if(result) {
					bcateno = $("#bcateno").val();
					$("#frm").attr("action", "/ccedu/*/deleteBoardInfo.do?bcateno=" + bcateno);
					$("#frm").submit();
					
				} else {
					return false;
				}
				
			})
		}

	</script>

</head>

<body>
<!-- skip nav -->
	<%@ include file="/WEB-INF/jsp/ccedu/inc/nav_inc.jsp"%>
<!--// skip nav -->


<div id="wrap">

	<!-- header -->
	<%@ include file="/WEB-INF/jsp/ccedu/inc/header_inc.jsp"%>
	<!--// header -->

	<!-- container -->
	<div id="container">

		<!-- location -->
		<!-- QNA -->
		<c:if test="${REQUEST_DATA.bcateno eq '13'}">
			<jsp:include page="/WEB-INF/jsp/ccedu/inc/location/loc_03_05.jsp"> 
			  	<jsp:param name="menuNm" value="Q&A"/> 
			</jsp:include> 
		</c:if>
		<!-- 자유게시판 -->
		<c:if test="${REQUEST_DATA.bcateno eq '10'}">
			<jsp:include page="/WEB-INF/jsp/ccedu/inc/location/loc_04_02.jsp"> 
			  	<jsp:param name="menuNm" value="자유게시판"/> 
			</jsp:include> 
		</c:if>
		<!--// location -->

		<div class="con_center">

			<!-- lnb -->
			<div id="lnb">
				<c:if test="${REQUEST_DATA.bcateno eq '13'}">
					<jsp:include page="/WEB-INF/jsp/ccedu/inc/lnb/lnb_03.jsp"> 
					  	<jsp:param name="dep2" value="05"/>
					  	<jsp:param name="dep3" value="03"/> 
					</jsp:include>
				</c:if> 
				<!-- 자유게시판 -->
				<c:if test="${REQUEST_DATA.bcateno eq '10'}">
					<jsp:include page="/WEB-INF/jsp/ccedu/inc/lnb/lnb_04.jsp"> 
					  	<jsp:param name="dep2" value="02"/>
					  	<jsp:param name="dep3" value="01"/> 
					</jsp:include>
				</c:if>
			</div>
			<!--// lnb -->

			<!-- content 본문 -->
			<div id="content">

				<c:if test="${REQUEST_DATA.bcateno eq '13'}">
					
				<!-- 기존 START 2018-08-30  -->
<!-- 					<h3 class="cont_titile">Q&amp;A</h3> -->
				<!-- 기존 END 2018-08-30  -->
				
				<!-- 2018-08-28 김동인 작업 S --> 
				<h3 class="cont_titile type03">Q&amp;A<span></span></h3>
				<!-- 2018-08-28 김동인 작업 E -->
				
				</c:if>
				<c:if test="${REQUEST_DATA.bcateno eq '10'}">
				
					<!-- 기존 START 2018-08-30  -->
<!-- 					<h3 class="cont_titile">자유게시판</h3> -->
					<!-- 기존 END 2018-08-30  -->
					
					<!-- 2018-08-28 김동인 작업 S --> 
					<h3 class="cont_titile type04">자유게시판<span></span></h3>
					<!-- 2018-08-28 김동인 작업 E -->
					
				</c:if>
				<!-- 본문내용 -->
				<div class="cont_body">
					<!-- start -->
					<div class="c_section">
						<form name="frm" id="frm" action="" method="post" enctype="multipart/form-data">
							<input type="hidden" name="cPage" id="cPage" value="<c:out value="${REQUEST_DATA.cPage}"/>"/>
							<input type="hidden" name="bbsNo" id="bbsNo" value="<c:out value="${rowData.BBSNO}" />"/>
							<input type="hidden" name="prevBbsNo" id="prevBbsNo" value=""/>
							<input type="hidden" name="nextBbsNo" id="nextBbsNo" value=""/>
							<input type="hidden" name="qu" id="qu" value=""/>
							<input type="hidden" name="searchWord" id="searchWord" value=""/>
							<input type="hidden" name="bcateno" id="bcateno" value="${REQUEST_DATA.bcateno}"/>
							<input type="hidden" name="secuYn"  id="secuYn" value="N"/>
							<input type="hidden" name="UPLOAD_DIR"  id="UPLOAD_DIR" value="/board"/>
							<input type="hidden" name="fileNo"  id="fileNo" value=""/>
							<input type="hidden" name="execFlag"  id="execFlag" value="<c:out value="${REQUEST_DATA.type}"/>"/>
							<input type="hidden" name="fileLength" value="${fn:length(listData)}" default="0">
						
							<div class="board_write">
								<table>
									<c:if test="${REQUEST_DATA.bcateno eq '13'}">
										<caption>Q&A 작성</caption>
									</c:if>
									<c:if test="${REQUEST_DATA.bcateno eq '10'}">
										<caption>자유게시판 작성</caption>
									</c:if>
									<tr>
										<th scope="row">제목</th>
										<td>
											<input type="text" class="text" id="title" name="title" placeholder="제목을 입력하세요." title="제목을 입력하세요" value="<c:out value="${rowData.TITLE}"/>" />
										</td>
									</tr>
									<c:if test="${REQUEST_DATA.bcateno eq '13'}">
									<tr>
										<th scope="row">비밀글 여부</th>
										<td>
											<div class="form_field">
												<div class="ff_check">
													<input type="checkbox" id="secuAt"  >
													<label for="secuAt">체크 시, 본인만 확인할 수 있습니다.</label>
												</div>
												
											</div>
										</td>
									</tr>
									</c:if>
									<tr>
										<th scope="row">내용</th>
										<td>
											<textarea placeholder="내용을 입력하세요." title="내용을 입력하세요" name="content" id="content2" ><c:out value="${rowData.CONTENT}" escapeXml="false"/></textarea>
										</td>
									</tr>
									<tr>
										<td colspan="2">
											<sapn style="color : red; font-size:12px">* 개인정보보호를 위해 주민등록번호, 주소, 전화번호 등은 내용에 남기지 마십시오.</sapn>
										</td>
									</tr>
									
								</table>
							</div>

							<div class="c_btn_center">
								<button type="button" onclick="fnList(); return false;" class="btn_graybg03">취소</button>
								<c:if test="${REQUEST_DATA.type eq 'UPDATE'}">
									<button type="button" onclick="fnDel(); return false;" class="btn_blueline03">삭제</button>
								</c:if>
								<button type="button" onclick="fnSave(); return false;" class="btn_bluebg03">완료</button>
							</div>
						</form>
						</div>

					</div>

					<!--// end -->
				</div>
				<!--// 본문내용 -->
				
			<!--  -->
			</div>
			<!--// content 본문 -->

		</div>
	</div>
	<!--// container -->

	<!-- foot -->
	<%@ include file="/WEB-INF/jsp/ccedu/inc/footer_inc.jsp"%>
	<!--// foot end -->

</div>

</body>
</html>